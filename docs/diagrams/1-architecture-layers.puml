@startuml
title CRM Service - Architecture Layers

!define RECTANGLE class
skinparam class {
    BackgroundColor #f9f9f9
    BorderColor #888
    ArrowColor #555
}

RECTANGLE "Presentation Layer\n(API V1, Controllers, Handlers,\nDTOs, Transformers)" as Presentation

RECTANGLE "Application / Domain Layer\n(CRM: Leads, Contacts,\nEntities, Value Objects,\nDomain Services, Repositories)" as Domain

RECTANGLE "Infrastructure Layer\n(Security, Service, Doctrine, Redis, Kafka)" as Infrastructure

RECTANGLE "External Services\n(Auth Service, Kafka Broker, MySQL, Redis)" as External

Presentation -down-> Domain : uses
Domain -down-> Infrastructure : uses
Infrastructure -down-> External : integrates with

note right of Presentation
- Controllers route HTTP requests
- Handlers orchestrate use cases
- DTOs define API contracts
- Transformers shape responses
end note

note right of Domain
- Contains business logic
- Defines entities, value objects
- Services encapsulate use cases
- Repositories abstract persistence
end note

note right of Infrastructure
- Doctrine for ORM
- Redis for cache and rate limit
- Kafka for async communication
- JWT Auth via external Auth Service
end note

note right of External
- Auth Service issues JWT tokens
- Kafka sends token invalidation events
- Redis stores invalidation timestamps
- MySQL persists CRM data
end note

@enduml
